# P4wnP1 demo payload by MaMe82
# ==========================


# =============================
# USB setup
# =============================
# Make sure to change USB_PID if you enable different USB functionality in order
# to force Windows to enumerate the device again
USB_VID="0x1d6b"        # Vendor ID
USB_PID="0x0137"        # Product ID

USE_ECM=true            # if true CDC ECM will be enabled
USE_RNDIS=true          # if true RNDIS will be enabled
USE_HID=true            # if true HID (keyboard) will be enabled
USE_RAWHID=true         # if true HID (keyboard) will be enabled
USE_UMS=false           # if true USB Mass Storage will be enabled

# disable setting of static routes for all IPv4 addresses
ROUTE_SPOOF=false

# use LED based HID keyboard test
USE_HID_TEST=true

# overwrite keyboard language from setup.cfg
lang="de" 

# This function gets called after the target network interface is working
# (RNDIS, CDC ECM or both have to be enabled)
function onNetworkUp()
{
	# print Network is running via Keyboard to host (test ASCII output via HID keyboard)
	# keyboard layout is derived from setup.cfg
	echo "Network is running" | outhid
}

# this function gets called if the target received a DHCP lease
# (DHCP client has to be running on target)
function onTargetGotIP()
{
	echo "DHCP Lease given to target"
	echo "Target IP $target_ip"

        # add route back through target (for ICS)
        route add -net default gw $target_ip

	# add DNS entry for google DNS
	echo nameserver 8.8.8.8 > /etc/resolv.conf

	echo "Target got IP $target_ip via DHCP" | outhid
}

function onKeyboardUp()
{
	# we need no initial keyboard delay, before starting the DuckyScript
	# if this method gets called, we know the HID keyboard stack is usable

	cat <<- EOF | duckhid
		GUI r
		DELAY 500
		STRING notepad.exe
		ENTER
		DELAY 1000
		STRING 2 seconds delay before next output (delay test)
		ENTER
		DELAY 2000
		STRING Delay passed by
		ENTER
EOF
	echo "Keyboard is running" | outhid
}

function onBootFinished()
{
	# we should land here even if no RNDIS / CDC ECM is enabled
	# as long as P4wnP1 gets connected to a target host


	# test for duckyscript (start notepad)
	# !!Note: the delays dramatically increase boot time and are only used for HID demo purposes


	# print "Boot finished" via HID keyboard (languag layoute selected in setup.cfg)
	echo "P4wnP1 boot up finished" | outhid

}

# commands in this function are ran on user login
# the commans are ran by user "pi"
function onLogin()
{
	#sudo python /root/hidsrv3.py
	return
}
